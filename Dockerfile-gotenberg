FROM gotenberg/gotenberg:8

USER root

# Install Microsoft core fonts
RUN echo "ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true" | debconf-set-selections && \
    apt-get update && \
    apt-get install -y --no-install-recommends ttf-mscorefonts-installer fontconfig && \
    fc-cache -fv

# Create fontconfig to force Aptos and Calibri â†’ Carlito (sans-serif)
RUN mkdir -p /etc/fonts/conf.d && \
    echo '<?xml version="1.0"?>' > /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '<!DOCTYPE fontconfig SYSTEM "fonts.dtd">' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '<fontconfig>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '  <match target="pattern">' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '    <test name="family"><string>Aptos</string></test>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '    <edit name="family" mode="assign" binding="strong"><string>Carlito</string></edit>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '  </match>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '  <match target="pattern">' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '    <test name="family"><string>Calibri</string></test>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '    <edit name="family" mode="assign" binding="strong"><string>Carlito</string></edit>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '  </match>' >> /etc/fonts/conf.d/65-force-carlito.conf && \
    echo '</fontconfig>' >> /etc/fonts/conf.d/65-force-carlito.conf

# Refresh cache
RUN fc-cache -fv && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

USER gotenberg
